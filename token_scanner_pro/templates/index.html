<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>Token Scanner Pro üöÄ - D√©tectez les Opportunit√©s Crypto Avant Tout le Monde</title>
    <meta name="title" content="Token Scanner Pro üöÄ - D√©tectez les Opportunit√©s Crypto Avant Tout le Monde">
    <meta name="description" content="Scanner IA professionnel avec analyse en temps r√©el, d√©tection pump & dump, et auto-scan 24/7. Analysez les tokens crypto avec l'intelligence artificielle Claude.">
    <meta name="keywords" content="crypto scanner, token scanner, pump dump detector, crypto analysis, IA crypto, blockchain scanner, DeFi tools, crypto trading">
    <meta name="author" content="Token Scanner Pro">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tokenscannerpro.com/">
    <meta property="og:title" content="Token Scanner Pro üöÄ - D√©tectez les Opportunit√©s Crypto Avant Tout le Monde">
    <meta property="og:description" content="Scanner IA professionnel avec analyse en temps r√©el, d√©tection pump & dump, et auto-scan 24/7. Prenez des d√©cisions √©clair√©es gr√¢ce √† l'intelligence artificielle.">
    <meta property="og:image" content="https://tokenscannerpro.com/static/og-image.jpg">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="Token Scanner Pro">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://tokenscannerpro.com/">
    <meta name="twitter:title" content="Token Scanner Pro üöÄ - D√©tectez les Opportunit√©s Crypto Avant Tout le Monde">
    <meta name="twitter:description" content="Scanner IA professionnel avec analyse en temps r√©el, d√©tection pump & dump, et auto-scan 24/7.">
    <meta name="twitter:image" content="https://tokenscannerpro.com/static/og-image.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">

    <!-- Theme Color -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #13131a;
            --bg-card: rgba(26, 26, 36, 0.7);
            --bg-glass: rgba(255, 255, 255, 0.03);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #0cebeb 0%, #20e3b2 100%);
            --gradient-danger: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-gold: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            --text-primary: #ffffff;
            --text-secondary: #a0a0b2;
            --text-tertiary: #6b6b80;
            --accent-primary: #667eea;
            --accent-success: #20e3b2;
            --accent-danger: #f5576c;
            --border-subtle: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Prevent all elements from overflowing */
        html, body {
            max-width: 100vw;
            overflow-x: hidden;
        }

        /* Ensure all flex and grid containers don't overflow */
        div, section, article, aside, header, footer, nav {
            max-width: 100%;
        }

        /* Ensure images and iframes are responsive */
        img, iframe {
            max-width: 100%;
            height: auto;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Welcome Section */
        .welcome {
            margin-bottom: 2rem;
        }

        .welcome h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome p {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }

        /* Stats Overview Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 1rem;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-primary);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .stat-subtitle {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .stat-change.positive {
            background: rgba(32, 227, 178, 0.1);
            color: var(--accent-success);
        }

        .stat-change.negative {
            background: rgba(245, 87, 108, 0.1);
            color: var(--accent-danger);
        }

        /* Main Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Scanner Section */
        .scanner-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 1rem;
            padding: 2rem;
            backdrop-filter: blur(20px);
            max-width: 100%;
            overflow-x: hidden; /* Prevent horizontal scroll in scanner section */
        }

        /* Scan results container - prevent overflow */
        #scan-results {
            max-width: 100%;
            overflow-x: hidden;
            word-wrap: break-word;
        }

        /* Token cards - constrain width */
        #scan-results > div {
            max-width: 100%;
            overflow: hidden;
        }

        /* Token stats grid - make responsive */
        #scan-results div[style*="grid-template-columns: repeat(4, 1fr)"] {
            display: grid !important;
            grid-template-columns: repeat(4, 1fr) !important;
            gap: 0.5rem !important;
        }

        /* Reduce to 2 columns on medium screens */
        @media (max-width: 1200px) {
            #scan-results div[style*="grid-template-columns: repeat(4, 1fr)"] {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Prevent long text overflow in token cards */
        #scan-results div[style*="font-family: monospace"] {
            word-break: break-all;
            overflow-wrap: break-word;
        }

        /* Constrain activity feed sections too */
        .activity-feed {
            max-width: 100%;
            overflow-x: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .scan-config {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-group label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .input-group input,
        .input-group select {
            padding: 0.75rem;
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* Recent Activity */
        .activity-feed {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 1rem;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .activity-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        /* Auto-Scan styles removed - feature not useful */

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--bg-glass);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .welcome h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                max-width: 100vw; /* Prevent overflow */
            }

            .welcome h1 {
                font-size: 1.75rem;
            }

            .welcome p {
                font-size: 1rem !important;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            /* Token cards grid - 1 column on mobile */
            .tokens-grid {
                grid-template-columns: 1fr !important;
            }

            /* Search input stack on mobile */
            #token-search-input {
                font-size: 16px !important; /* Prevent zoom on iOS */
            }

            /* Prevent section overflow */
            .scanner-section,
            .activity-feed {
                padding: 1rem !important;
                max-width: 100%;
                overflow-x: hidden;
            }

            /* Main grid responsive */
            .main-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 0.75rem;
                max-width: 100vw;
            }

            .welcome {
                padding: 1.5rem 1rem !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
            }

            .welcome h1 {
                font-size: 1.5rem !important;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 1.75rem !important;
            }

            /* Modal responsive */
            #token-details-modal > div {
                padding: 1rem !important;
                margin: 0 !important;
                border-radius: 0 !important;
                max-height: 100vh !important;
            }

            #token-details-modal {
                padding: 0 !important;
            }

            /* Token cards - reduce padding on mobile */
            #scan-results > div {
                padding: 0.75rem !important;
            }

            /* Reduce all section paddings */
            .scanner-section,
            .activity-feed,
            .stat-card {
                padding: 0.75rem !important;
            }
        }

        /* Am√©lioration responsive pour les petits √©crans */
        @media (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }

            .section-title {
                font-size: 1.125rem;
            }

            /* Search form stack */
            .search-form {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }

            .search-btn {
                width: 100% !important;
                padding: 1rem !important;
            }

            /* Welcome section - very compact on tiny screens */
            .welcome {
                padding: 1rem 0.75rem !important;
            }

            /* All sections compact */
            .scanner-section,
            .activity-feed,
            .stat-card {
                padding: 0.5rem !important;
                border-radius: 0.75rem !important;
            }

            /* Reduce gaps everywhere */
            .stats-grid,
            .main-grid {
                gap: 0.75rem !important;
            }

            /* Buttons smaller */
            .btn {
                padding: 0.6rem 1rem !important;
                font-size: 0.8rem !important;
            }

            /* Force word break in long addresses */
            div[style*="font-family: monospace"] {
                word-break: break-all;
            }

            /* News refresh button */
            .activity-feed > div:first-child {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.75rem !important;
            }
        }
    </style>
</head>
<body data-page="home">
    <!-- Navigation Component -->
    {% include 'components_nav.html' %}

    <!-- Barre de progression Auto-Scan (Discr√®te) -->
    {% include 'components_scan_progress.html' %}

    <div class="container">
        <!-- Hero Section - Marketing Optimized -->
        <div class="welcome" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%); border: 1px solid var(--border-subtle); border-radius: 1.5rem; padding: 4rem 2rem; margin-bottom: 3rem; text-align: center; backdrop-filter: blur(20px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); position: relative; overflow: hidden;">

            <!-- Decorative elements -->
            <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(102, 126, 234, 0.15) 0%, transparent 70%); border-radius: 50%; animation: pulse 4s ease-in-out infinite;"></div>
            <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(118, 75, 162, 0.15) 0%, transparent 70%); border-radius: 50%; animation: pulse 3s ease-in-out infinite;"></div>

            <div style="position: relative; z-index: 1;">
                <!-- Badge de bienvenue -->
                <div style="display: inline-block; background: rgba(102, 126, 234, 0.15); border: 1px solid rgba(102, 126, 234, 0.3); padding: 0.5rem 1.25rem; border-radius: 2rem; margin-bottom: 1.5rem; animation: fadeInUp 0.6s ease-out;">
                    <span style="font-weight: 600; font-size: 0.875rem; color: var(--accent-primary);">üëã Bienvenue <span id="welcome-name" style="text-transform: capitalize;">Trader</span></span>
                </div>

                <!-- Hero Title -->
                <h1 style="font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 900; margin-bottom: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: fadeInUp 0.6s ease-out 0.1s backwards; line-height: 1.2;">
                    D√©tectez les Opportunit√©s Crypto<br/>Avant Tout le Monde
                </h1>

                <!-- Value Proposition -->
                <p style="color: var(--text-secondary); font-size: clamp(1rem, 2vw, 1.25rem); max-width: 750px; margin: 0 auto 2.5rem; line-height: 1.6; animation: fadeInUp 0.6s ease-out 0.2s backwards;">
                    Scanner IA professionnel avec analyse en temps r√©el, d√©tection pump & dump, et auto-scan 24/7.
                    <strong style="color: var(--accent-primary);">Prenez des d√©cisions √©clair√©es</strong> gr√¢ce √† l'intelligence artificielle.
                </p>

                <!-- Value Props Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.25rem; max-width: 900px; margin: 0 auto 2.5rem; animation: fadeInUp 0.6s ease-out 0.3s backwards;">
                    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border: 1px solid rgba(34, 197, 94, 0.25); padding: 1.25rem; border-radius: 1rem; text-align: left;">
                        <div style="font-size: 2rem; margin-bottom: 0.75rem;">ü§ñ</div>
                        <div style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem; color: #22c55e;">Scanner IA Avanc√©</div>
                        <div style="font-size: 0.8rem; color: var(--text-tertiary); line-height: 1.4;">Analyse intelligente avec d√©tection des risques en temps r√©el</div>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%); border: 1px solid rgba(102, 126, 234, 0.25); padding: 1.25rem; border-radius: 1rem; text-align: left;">
                        <div style="font-size: 2rem; margin-bottom: 0.75rem;">‚ö°</div>
                        <div style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem; color: var(--accent-primary);">Auto-Scan 5min</div>
                        <div style="font-size: 0.8rem; color: var(--text-tertiary); line-height: 1.4;">Surveillance automatique des nouveaux tokens 24/7</div>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(249, 115, 22, 0.05) 100%); border: 1px solid rgba(249, 115, 22, 0.25); padding: 1.25rem; border-radius: 1rem; text-align: left;">
                        <div style="font-size: 2rem; margin-bottom: 0.75rem;">üõ°Ô∏è</div>
                        <div style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem; color: #f97316;">Protection P&D</div>
                        <div style="font-size: 0.8rem; color: var(--text-tertiary); line-height: 1.4;">D√©tection avanc√©e des pump & dump suspects</div>
                    </div>
                </div>

                <!-- CTA Button -->
                <button onclick="scrollToScanner()" style="padding: 1.25rem 3rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 3rem; font-weight: 700; font-size: 1.125rem; cursor: pointer; box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4); transition: all 0.3s; animation: fadeInUp 0.6s ease-out 0.4s backwards; position: relative; overflow: hidden;" onmouseenter="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 12px 40px rgba(102, 126, 234, 0.6)';" onmouseleave="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 30px rgba(102, 126, 234, 0.4)';">
                    <span>üöÄ Commencer l'Analyse</span>
                </button>

                <!-- Trust badges -->
                <div style="display: flex; gap: 2rem; justify-content: center; margin-top: 2.5rem; flex-wrap: wrap; animation: fadeInUp 0.6s ease-out 0.5s backwards;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-tertiary); font-size: 0.85rem;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" fill="#22c55e"/></svg>
                        <span>Scanner IA Claude</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-tertiary); font-size: 0.85rem;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 0C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" fill="#667eea"/><path d="M13.5 7.5L9 12 6.5 9.5" stroke="#667eea" stroke-width="2" stroke-linecap="round"/></svg>
                        <span>Analyse Temps R√©el</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-tertiary); font-size: 0.85rem;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 2v16M2 10h16" stroke="#f97316" stroke-width="2.5" stroke-linecap="round"/></svg>
                        <span>Gratuit & Open Source</span>
                    </div>
                </div>
            </div>
        </div>

        <style>
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes pulse {
                0%, 100% {
                    transform: scale(1);
                    opacity: 0.5;
                }
                50% {
                    transform: scale(1.1);
                    opacity: 0.8;
                }
            }
        </style>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Scanner Section -->
            <div class="scanner-section" id="scanner">
                <div class="section-header">
                    <h2 class="section-title">üîç Scanner un Token</h2>
                </div>

                <div class="scan-config">
                    <div class="input-group">
                        <label for="max-tokens">Nombre de tokens √† scanner</label>
                        <select id="max-tokens">
                            <option value="5">5 tokens</option>
                            <option value="10" selected>10 tokens</option>
                            <option value="20">20 tokens</option>
                            <option value="50">50 tokens</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-primary" id="start-scan-btn" onclick="startScan()" style="width: 100%; padding: 1rem; font-size: 1rem; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 0.75rem; color: white; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); display: flex; align-items: center; justify-content: center; gap: 0.5rem;" onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';" onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
                    <span style="font-size: 1.25rem;">üöÄ</span>
                    <span>Lancer le Scanner IA</span>
                </button>

                <div id="scan-progress" style="margin-top: 1.5rem; display: none;">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 1rem;">Scan en cours...</p>
                        <p id="scan-status" style="font-size: 0.875rem; color: var(--text-secondary);"></p>
                    </div>
                </div>

                <div id="scan-results" style="margin-top: 1.5rem; display: none;">
                    <!-- Results will be injected here -->
                </div>
            </div>

            <!-- Crypto News -->
            <div class="activity-feed" style="margin-top: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 class="section-title">üì∞ Actualit√©s Crypto</h3>
                    <button onclick="refreshNews()" style="padding: 0.5rem 1rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); border-radius: 0.5rem; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; transition: all 0.2s;">
                        <span id="news-refresh-icon">üîÑ</span> Actualiser
                    </button>
                </div>
                <div id="news-cache-info" style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.75rem;"></div>
                <div id="news-list">
                    <div class="loading" style="text-align: center; padding: 2rem;">
                        <div class="spinner" style="border: 3px solid var(--bg-glass); border-top: 3px solid var(--accent-primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">Chargement des actualit√©s...</p>
                    </div>
                </div>
            </div>

            <!-- Token Search -->
            <div class="activity-feed" style="margin-top: 2rem;">
                <h3 class="section-title" style="margin-bottom: 1rem;">üîç Rechercher un Token</h3>
                <div class="search-form" style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                    <input
                        type="text"
                        id="token-search-input"
                        placeholder="Ex: BTC, ETH, bitcoin, ethereum..."
                        style="flex: 1; padding: 0.75rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); border-radius: 0.5rem; color: var(--text-primary); font-size: 0.9rem;"
                        onkeypress="if(event.key === 'Enter') searchToken()"
                    />
                    <button onclick="searchToken()" class="search-btn" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); white-space: nowrap;">
                        Rechercher
                    </button>
                </div>
                <div id="token-search-results"></div>
            </div>
        </div>
    </div>

    <script>
        // Load user info and update welcome
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/me');
                const data = await response.json();

                if (data.authenticated && data.user) {
                    const user = data.user;
                    document.getElementById('welcome-name').textContent = user.username;
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        // Scroll to scanner
        function scrollToScanner() {
            document.getElementById('scanner').scrollIntoView({ behavior: 'smooth' });
        }

        // Toggle favorite
        async function toggleFavorite(address, chain, tokenIndex) {
            const tokenData = window.currentTokens[tokenIndex];
            if (!tokenData) {
                console.error('Token not found');
                return;
            }

            const btn = document.getElementById(`fav-btn-${address}`);

            try {
                // Check if already favorited
                const checkResponse = await fetch('/api/favorites');
                const checkData = await checkResponse.json();

                const isFavorited = checkData.success && checkData.favorites.some(fav =>
                    fav.token_address === address && fav.chain === chain
                );

                if (isFavorited) {
                    // Remove from favorites
                    const response = await fetch('/api/favorites/remove', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token_address: address, chain: chain })
                    });

                    const data = await response.json();
                    if (data.success) {
                        btn.innerHTML = '<span style="font-size: 1.25rem;">‚≠ê</span>';
                        btn.style.background = 'rgba(0, 0, 0, 0.5)';
                        console.log('‚úÖ Retir√© des favoris');
                    }
                } else {
                    // Add to favorites
                    const response = await fetch('/api/favorites/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            token_address: address,
                            chain: chain,
                            token_data: tokenData
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        btn.innerHTML = '<span style="font-size: 1.25rem;">‚≠ê</span>';
                        btn.style.background = 'rgba(255, 215, 0, 0.3)';
                        btn.style.borderColor = '#ffd700';
                        console.log('‚úÖ Ajout√© aux favoris');
                    }
                }

                // Refresh favorites count
                await loadFavoritesCount();
            } catch (error) {
                console.error('Erreur favoris:', error);
            }
        }

        // Refresh token price from Moralis API
        async function refreshTokenPrice(address, chain, tokenIndex) {
            const priceDiv = document.getElementById(`price-${address}`);
            const changeDiv = document.getElementById(`change-${address}`);
            const refreshBtn = document.getElementById(`refresh-btn-${address}`);
            const refreshIcon = document.getElementById(`refresh-icon-${address}`);

            if (!priceDiv || !changeDiv || !refreshBtn) {
                console.error('Price elements not found for', address);
                return;
            }

            try {
                // Animate button - spin animation
                refreshIcon.style.display = 'inline-block';
                refreshIcon.style.animation = 'spin 1s linear infinite';
                refreshBtn.disabled = true;
                refreshBtn.style.opacity = '0.7';

                console.log(`üí∞ Refreshing price for ${address.substring(0, 10)}... on ${chain}`);

                // Call Moralis API
                const response = await fetch(`/api/token/price?address=${address}&chain=${chain}`);
                const data = await response.json();

                if (data.success && data.usd_price !== null && data.usd_price !== undefined) {
                    const newPrice = data.usd_price;
                    const priceChange24h = data.usd_price_24h_change_percent || 0;

                    // Format price
                    const formatPrice = (p) => {
                        if (p >= 1) return '$' + p.toFixed(4);
                        if (p >= 0.0001) return '$' + p.toFixed(6);
                        return '$' + p.toExponential(2);
                    };

                    const formatChange = (val) => (val >= 0 ? '+' : '') + val.toFixed(2) + '%';
                    const colorChange = (val) => val >= 0 ? '#22c55e' : '#ef4444';

                    // Animate price update with flash effect
                    priceDiv.style.transition = 'all 0.3s ease';
                    changeDiv.style.transition = 'all 0.3s ease';

                    // Flash effect
                    priceDiv.style.background = 'rgba(102, 126, 234, 0.3)';
                    changeDiv.style.background = 'rgba(102, 126, 234, 0.3)';

                    setTimeout(() => {
                        // Update values
                        priceDiv.textContent = formatPrice(newPrice);
                        changeDiv.textContent = formatChange(priceChange24h);
                        changeDiv.style.color = colorChange(priceChange24h);

                        // Update token data in global array
                        if (window.currentTokens && window.currentTokens[tokenIndex]) {
                            if (!window.currentTokens[tokenIndex].market) {
                                window.currentTokens[tokenIndex].market = {};
                            }
                            window.currentTokens[tokenIndex].market.price_usd = newPrice;
                            window.currentTokens[tokenIndex].market.price_change_24h = priceChange24h;
                        }

                        // Remove flash after animation
                        setTimeout(() => {
                            priceDiv.style.background = 'transparent';
                            changeDiv.style.background = 'transparent';
                        }, 300);
                    }, 100);

                    console.log(`‚úÖ Prix mis √† jour: ${formatPrice(newPrice)} (${formatChange(priceChange24h)})`);
                } else {
                    console.warn('‚ö†Ô∏è Pas de prix disponible:', data);
                    // Show error briefly
                    refreshIcon.textContent = '‚ùå';
                    setTimeout(() => {
                        refreshIcon.textContent = 'üîÑ';
                    }, 2000);
                }

            } catch (error) {
                console.error('‚ùå Error refreshing price:', error);
                // Show error briefly
                refreshIcon.textContent = '‚ùå';
                setTimeout(() => {
                    refreshIcon.textContent = 'üîÑ';
                }, 2000);
            } finally {
                // Stop animation
                refreshIcon.style.animation = '';
                refreshBtn.disabled = false;
                refreshBtn.style.opacity = '1';
            }
        }

        // Start scan
        async function startScan() {
            // Reset auto-scan countdown to 5 minutes when manual scan starts
            if (typeof secondsRemaining !== 'undefined') {
                secondsRemaining = 300;
                updateCountdown();
            }

            const maxTokens = parseInt(document.getElementById('max-tokens').value);

            const btn = document.getElementById('start-scan-btn');
            btn.disabled = true;
            btn.innerHTML = '<span style="font-size: 1.25rem;">‚è≥</span><span>Scan en cours...</span>';

            document.getElementById('scan-progress').style.display = 'block';
            document.getElementById('scan-results').style.display = 'none';

            try {
                const response = await fetch('/api/scan/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        max_tokens: maxTokens
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Poll for results
                    pollScanResults();
                } else {
                    alert('Erreur: ' + (data.error || '√âchec du scan'));
                    btn.disabled = false;
                    btn.innerHTML = '<span style="font-size: 1.25rem;">üöÄ</span><span>Lancer le Scanner IA</span>';
                    document.getElementById('scan-progress').style.display = 'none';
                }
            } catch (error) {
                alert('Erreur r√©seau');
                btn.disabled = false;
                btn.innerHTML = '<span style="font-size: 1.25rem;">üöÄ</span><span>Lancer le Scanner IA</span>';
                document.getElementById('scan-progress').style.display = 'none';
            }
        }

        // Poll scan results
        async function pollScanResults() {
            try {
                const response = await fetch('/api/scan/progress');
                const data = await response.json();

                if (data.in_progress) {
                    document.getElementById('scan-status').textContent = data.message || 'Analyse en cours...';
                    setTimeout(pollScanResults, 2000);
                } else {
                    // Scan complete
                    const resultsResponse = await fetch('/api/scan/results');
                    const resultsData = await resultsResponse.json();

                    displayScanResults(resultsData);

                    const btn = document.getElementById('start-scan-btn');
                    btn.disabled = false;
                    btn.innerHTML = '<span style="font-size: 1.25rem;">üöÄ</span><span>Lancer le Scanner IA</span>';
                    document.getElementById('scan-progress').style.display = 'none';
                }
            } catch (error) {
                console.error('Error polling:', error);
                setTimeout(pollScanResults, 2000);
            }
        }

        // Load tokens from database on page load
        async function loadTokensFromDatabase() {
            try {
                console.log('üîÑ Loading tokens from database...');
                const response = await fetch('/api/scanned-tokens?limit=50');
                const data = await response.json();

                console.log('üì° API Response:', data);

                if (data.success && data.tokens && data.tokens.length > 0) {
                    console.log(`üì¶ Chargement de ${data.tokens.length} tokens depuis la BDD`);

                    // Transform database format to scan results format
                    const transformedResults = data.tokens.map(token => {
                        // Parse token_data if it's a string
                        let tokenData = token.token_data;
                        if (typeof tokenData === 'string') {
                            try {
                                tokenData = JSON.parse(tokenData);
                            } catch (e) {
                                console.warn('Failed to parse token_data:', e);
                                tokenData = {};
                            }
                        }
                        tokenData = tokenData || {};

                        return {
                            address: token.token_address,
                            chain: token.token_chain,
                            risk_score: token.risk_score || 50,
                            is_safe: token.is_safe !== undefined ? token.is_safe : false,
                            is_pump_dump_suspect: token.is_pump_dump_suspect || false,
                            description: tokenData.description || token.token_address?.substring(0, 10) + '...',
                            icon: tokenData.icon || null,
                            market: tokenData.market || {},
                            security: tokenData.security || {},
                            twitter_data: tokenData.twitter_data || {},
                            social_score: tokenData.social_score || 0,
                            pump_dump_score: tokenData.pump_dump_score || 0,
                            pump_dump_risk: tokenData.pump_dump_risk || 'UNKNOWN',
                            warnings: tokenData.warnings || [],
                            ...tokenData  // Merge all remaining token data
                        };
                    });

                    // Count safe/dangerous tokens
                    const safeCount = transformedResults.filter(t => t.is_safe).length;
                    const dangerousCount = transformedResults.length - safeCount;
                    const pumpDumpCount = transformedResults.filter(t => t.is_pump_dump_suspect).length;

                    // Display using existing function
                    displayScanResults({
                        success: true,
                        results: transformedResults,
                        total_analyzed: transformedResults.length,
                        safe_count: safeCount,
                        dangerous_count: dangerousCount,
                        pump_dump_suspects_count: pumpDumpCount
                    });

                    // Show info message
                    const scanResults = document.getElementById('scan-results');
                    const firstChild = scanResults.firstElementChild;
                    if (firstChild) {
                        firstChild.innerHTML = `
                            <h3 style="font-size: 1.75rem; font-weight: 900; margin-bottom: 0.5rem;">üíæ Tokens Charg√©s depuis la Base de Donn√©es</h3>
                            <p style="color: var(--text-secondary); font-size: 1.125rem;">
                                ${data.tokens.length} token(s) disponible(s) ‚Ä¢
                                <span style="color: #22c55e; font-weight: 600;">${safeCount} s√ªrs</span> ‚Ä¢
                                <span style="color: #ef4444; font-weight: 600;">${dangerousCount} risqu√©s</span> ‚Ä¢
                                <span style="color: #f59e0b; font-weight: 600;">${pumpDumpCount} P&D suspects</span>
                            </p>
                            <p style="color: var(--text-tertiary); font-size: 0.875rem; margin-top: 0.5rem;">
                                üìä Cache: ${data.total}/${data.max_capacity} tokens stock√©s
                            </p>
                        `;
                    }
                } else {
                    console.log('üì≠ Aucun token en cache, lancez un scan pour commencer');

                    // Show empty state with call to action
                    const scanResults = document.getElementById('scan-results');
                    scanResults.style.display = 'block';
                    scanResults.innerHTML = `
                        <div style="text-align: center; padding: 4rem 2rem; background: var(--bg-card); border: 2px dashed var(--border-subtle); border-radius: 1rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üîç</div>
                            <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.75rem; color: var(--text-primary);">Aucun Token Scann√©</h3>
                            <p style="color: var(--text-secondary); font-size: 1rem; margin-bottom: 2rem; max-width: 500px; margin-left: auto; margin-right: auto;">
                                La base de donn√©es est vide. Lancez votre premier scan pour d√©couvrir les derniers tokens crypto et commencer l'analyse !
                            </p>
                            <button onclick="scrollToScanner()" style="padding: 1rem 2rem; background: var(--gradient-primary); color: white; border: none; border-radius: 0.75rem; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s;">
                                üöÄ Lancer un Scan
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erreur chargement tokens:', error);
            }
        }

        // Store current tokens globally for AI analysis
        window.currentTokens = [];

        // Update favorite buttons to show current state
        async function updateFavoriteButtons() {
            try {
                const response = await fetch('/api/favorites');
                const data = await response.json();

                if (data.success && data.favorites) {
                    data.favorites.forEach(fav => {
                        const btn = document.getElementById(`fav-btn-${fav.token_address}`);
                        if (btn) {
                            btn.style.background = 'rgba(255, 215, 0, 0.3)';
                            btn.style.borderColor = '#ffd700';
                        }
                    });
                }
            } catch (error) {
                console.log('Error loading favorites state:', error);
            }
        }

        // Open token details modal
        function openTokenDetails(tokenIndex) {
            const token = window.currentTokens[tokenIndex];
            if (!token) {
                console.error('Token not found at index:', tokenIndex);
                return;
            }

            const hasMarketData = token.market && !token.market.error;
            const hasSecurity = token.security && !token.security.error;

            // Create modal
            const modal = document.createElement('div');
            modal.id = 'token-details-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 2rem; backdrop-filter: blur(10px);';

            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: 1rem; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 2rem; position: relative;">
                    <!-- Close button -->
                    <button onclick="document.getElementById('token-details-modal').remove()" style="position: absolute; top: 1rem; right: 1rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); border-radius: 0.5rem; width: 40px; height: 40px; cursor: pointer; font-size: 1.5rem; color: var(--text-secondary); transition: all 0.2s;" onmouseenter="this.style.background='rgba(239, 68, 68, 0.2)'; this.style.borderColor='#ef4444'; this.style.color='#ef4444';" onmouseleave="this.style.background='var(--bg-glass)'; this.style.borderColor='var(--border-subtle)'; this.style.color='var(--text-secondary)';">‚úï</button>

                    <!-- Header -->
                    <div style="display: flex; gap: 1.5rem; align-items: start; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-subtle);">
                        ${token.icon ? `<img src="${token.icon}" style="width: 80px; height: 80px; border-radius: 1rem;">` : '<div style="width: 80px; height: 80px; border-radius: 1rem; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">ü™ô</div>'}
                        <div style="flex: 1;">
                            <h2 style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.5rem;">${token.description || 'Token Details'}</h2>
                            <div style="font-family: monospace; font-size: 0.9rem; color: var(--text-tertiary); margin-bottom: 1rem;">${token.address}</div>
                            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                <span style="background: var(--bg-glass); padding: 0.5rem 1rem; border-radius: 1rem; font-weight: 600;">${token.chain.toUpperCase()}</span>
                                ${token.is_safe ? '<span style="background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 0.5rem 1rem; border-radius: 1rem; font-weight: 600;">‚úÖ SAFE</span>' : '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 0.5rem 1rem; border-radius: 1rem; font-weight: 600;">‚ö†Ô∏è RISKY</span>'}
                                <span style="background: var(--gradient-primary); color: white; padding: 0.5rem 1rem; border-radius: 1rem; font-weight: 700;">Risk: ${token.risk_score}/100</span>
                            </div>
                        </div>
                    </div>

                    <!-- Full Details Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        ${hasMarketData ? `
                            <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1.25rem;">
                                <h3 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem; text-transform: uppercase;">üíπ Market Data</h3>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.9rem;">
                                    <div style="display: flex; justify-content: space-between;"><span>Price:</span><span style="font-weight: 700;">$${token.market.price_usd?.toFixed(8) || 'N/A'}</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>24h Change:</span><span style="font-weight: 700; color: ${token.market.price_change_24h >= 0 ? '#22c55e' : '#ef4444'};">${(token.market.price_change_24h >= 0 ? '+' : '')}${token.market.price_change_24h?.toFixed(2) || '0'}%</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Liquidity:</span><span style="font-weight: 700;">$${(token.market.liquidity_usd / 1000).toFixed(2)}K</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Volume 24h:</span><span style="font-weight: 700;">$${(token.market.volume_24h / 1000).toFixed(2)}K</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Market Cap:</span><span style="font-weight: 700;">$${(token.market.market_cap / 1000).toFixed(2)}K</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Buys/Sells:</span><span style="font-weight: 700;">${token.market.txns_24h_buys || 0}/${token.market.txns_24h_sells || 0}</span></div>
                                </div>
                            </div>
                        ` : ''}

                        ${hasSecurity ? `
                            <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1.25rem;">
                                <h3 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem; text-transform: uppercase;">üîí Security</h3>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.9rem;">
                                    <div style="display: flex; justify-content: space-between;"><span>Buy Tax:</span><span style="font-weight: 700; color: ${token.security.buy_tax > 10 ? '#ef4444' : '#22c55e'};">${token.security.buy_tax?.toFixed(1) || 0}%</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Sell Tax:</span><span style="font-weight: 700; color: ${token.security.sell_tax > 10 ? '#ef4444' : '#22c55e'};">${token.security.sell_tax?.toFixed(1) || 0}%</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Honeypot:</span><span style="font-weight: 700; color: ${token.security.is_honeypot ? '#ef4444' : '#22c55e'};">${token.security.is_honeypot ? '‚ùå Yes' : '‚úÖ No'}</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Mintable:</span><span style="font-weight: 700; color: ${token.security.is_mintable ? '#f59e0b' : '#22c55e'};">${token.security.is_mintable ? '‚ö†Ô∏è Yes' : '‚úÖ No'}</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Open Source:</span><span style="font-weight: 700; color: ${token.security.is_open_source ? '#22c55e' : '#f59e0b'};">${token.security.is_open_source ? '‚úÖ Yes' : '‚ö†Ô∏è No'}</span></div>
                                    <div style="display: flex; justify-content: space-between;"><span>Holders:</span><span style="font-weight: 700;">${token.security.holder_count || 'N/A'}</span></div>
                                </div>
                            </div>
                        ` : ''}

                        ${token.pump_dump_score ? `
                            <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1.25rem;">
                                <h3 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem; text-transform: uppercase;">üö® Pump & Dump Risk</h3>
                                <div style="text-align: center; margin-bottom: 1rem;">
                                    <div style="font-size: 3rem; font-weight: 800; background: var(--gradient-danger); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${token.pump_dump_score}/100</div>
                                    <div style="font-size: 1rem; font-weight: 700; color: ${token.pump_dump_risk === 'FAIBLE' ? '#22c55e' : token.pump_dump_risk === 'MOYEN' ? '#f59e0b' : '#ef4444'};">${token.pump_dump_risk}</div>
                                </div>
                                ${token.pump_dump_warnings && token.pump_dump_warnings.length > 0 ? `
                                    <div style="background: rgba(239, 68, 68, 0.1); border-radius: 0.5rem; padding: 0.75rem; font-size: 0.8rem; line-height: 1.5;">
                                        ${token.pump_dump_warnings.slice(0, 5).map(w => `<div style="margin-bottom: 0.5rem;">‚Ä¢ ${w}</div>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        ${token.creator_security?.is_malicious ? `
                            <div style="background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(220, 38, 38, 0.05) 100%); border: 2px solid #dc2626; border-radius: 0.75rem; padding: 1.25rem;">
                                <h3 style="font-size: 0.875rem; font-weight: 700; color: #dc2626; margin-bottom: 1rem; text-transform: uppercase;">üíÄ CR√âATEUR BLACKLIST√â</h3>
                                <div style="background: rgba(220, 38, 38, 0.2); border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem;">
                                    <div style="font-weight: 700; font-size: 1rem; color: #dc2626; margin-bottom: 0.5rem;">‚ö†Ô∏è SCAMMER R√âCIDIVISTE D√âTECT√â</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Ce token a √©t√© cr√©√© par une adresse connue pour des activit√©s frauduleuses.</div>
                                    ${token.creator_address ? `<div style="font-family: monospace; font-size: 0.75rem; color: var(--text-tertiary); word-break: break-all;">Cr√©ateur: ${token.creator_address}</div>` : ''}
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.8rem;">
                                    ${token.creator_security.malicious_address_type ? `<div>Type: <span style="font-weight: 700; color: #dc2626;">${token.creator_security.malicious_address_type}</span></div>` : ''}
                                    ${token.creator_security.phishing_activities ? `<div>üé£ Phishing: <span style="font-weight: 700;">${token.creator_security.phishing_activities} activit√©s</span></div>` : ''}
                                    ${token.creator_security.honeypot_related_address ? `<div>üçØ Li√© √† des honeypots</div>` : ''}
                                    ${token.creator_security.darkweb_transactions ? `<div>üïµÔ∏è Transactions darkweb</div>` : ''}
                                    ${token.creator_security.stealing_attack ? `<div>üí∞ Attaques de vol d√©tect√©es</div>` : ''}
                                </div>
                            </div>
                        ` : ''}

                        ${token.rugpull_detection?.is_rugpull_risk ? `
                            <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(245, 158, 11, 0.05) 100%); border: 2px solid #f59e0b; border-radius: 0.75rem; padding: 1.25rem;">
                                <h3 style="font-size: 0.875rem; font-weight: 700; color: #f59e0b; margin-bottom: 1rem; text-transform: uppercase;">üé£ RISQUE RUG-PULL</h3>
                                <div style="text-align: center; margin-bottom: 1rem;">
                                    <div style="font-size: 2rem; font-weight: 800; color: #f59e0b;">${token.rugpull_detection.rugpull_risk_level?.toUpperCase() || 'D√âTECT√â'}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Patterns suspects dans le smart contract</div>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.8rem;">
                                    ${token.rugpull_detection.liquidity_removable ? `<div style="color: #ef4444;">üíß Liquidit√© peut √™tre retir√©e</div>` : ''}
                                    ${!token.rugpull_detection.ownership_renounced ? `<div style="color: #f59e0b;">üë§ Ownership non renonc√©</div>` : ''}
                                    ${token.rugpull_detection.transfer_pausable ? `<div style="color: #f59e0b;">‚è∏Ô∏è Transfers peuvent √™tre paus√©s</div>` : ''}
                                    ${token.rugpull_detection.can_take_back_ownership ? `<div style="color: #ef4444;">üîÑ Owner peut reprendre le contr√¥le</div>` : ''}
                                    ${token.rugpull_detection.hidden_owner ? `<div style="color: #ef4444;">üïµÔ∏è Owner cach√© d√©tect√©</div>` : ''}
                                    ${token.rugpull_detection.slippage_modifiable ? `<div style="color: #f59e0b;">üìä Slippage modifiable</div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- All Warnings -->
                    ${token.warnings && token.warnings.length > 0 ? `
                        <div style="background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.75rem; padding: 1.25rem; margin-bottom: 1.5rem;">
                            <h3 style="font-size: 0.875rem; font-weight: 700; color: #ef4444; margin-bottom: 1rem; text-transform: uppercase;">‚ö†Ô∏è All Warnings</h3>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.875rem; line-height: 1.6;">
                                ${token.warnings.map(w => `<div>‚Ä¢ ${w}</div>`).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Actions -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <button onclick="analyzeTokenWithAI(${tokenIndex}, this); event.stopPropagation();" style="padding: 1rem; background: var(--gradient-primary); color: white; border: none; border-radius: 0.75rem; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
                            ü§ñ Analyze with AI
                        </button>
                        ${token.url ? `<a href="${token.url}" target="_blank" style="padding: 1rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); color: var(--text-primary); text-decoration: none; text-align: center; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s;">üìä DexScreener</a>` : ''}
                        ${token.website ? `<a href="${token.website}" target="_blank" style="padding: 1rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6; text-decoration: none; text-align: center; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s;">üåê Website</a>` : ''}
                        ${token.twitter ? `<a href="${token.twitter}" target="_blank" style="padding: 1rem; background: rgba(29, 161, 242, 0.1); border: 1px solid rgba(29, 161, 242, 0.3); color: #1da1f2; text-decoration: none; text-align: center; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s;">üê¶ Twitter</a>` : ''}
                        ${token.telegram ? `<a href="${token.telegram}" target="_blank" style="padding: 1rem; background: rgba(34, 197, 233, 0.1); border: 1px solid rgba(34, 197, 233, 0.3); color: #22c5e9; text-decoration: none; text-align: center; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s;">‚úàÔ∏è Telegram</a>` : ''}
                        ${token.discord ? `<a href="${token.discord}" target="_blank" style="padding: 1rem; background: rgba(88, 101, 242, 0.1); border: 1px solid rgba(88, 101, 242, 0.3); color: #5865f2; text-decoration: none; text-align: center; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s;">üí¨ Discord</a>` : ''}
                    </div>
                </div>
            `;

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            document.body.appendChild(modal);
        }

        // Display scan results - ENHANCED WITH ALL AVAILABLE DATA
        function displayScanResults(data) {
            const container = document.getElementById('scan-results');
            container.style.display = 'block';

            console.log('üìä Displaying scan results:', data);

            if (data.results && data.results.length > 0) {
                // Store tokens globally
                window.currentTokens = data.results;

                // Build enriched tokens list
                const tokensHTML = data.results.map((token, index) => {
                    const hasMarketData = token.market && !token.market.error;
                    const hasSecurity = token.security && !token.security.error;
                    const hasTwitter = token.twitter_data && !token.twitter_data.error;

                    // Price & changes
                    const price = hasMarketData ? token.market.price_usd : 0;
                    const change24h = hasMarketData ? (token.market.price_change_24h || 0) : 0;
                    const change6h = hasMarketData ? (token.market.price_change_6h || 0) : 0;
                    const change1h = hasMarketData ? (token.market.price_change_1h || 0) : 0;

                    // Market data
                    const liquidity = hasMarketData ? (token.market.liquidity_usd || 0) : 0;
                    const volume24h = hasMarketData ? (token.market.volume_24h || 0) : 0;
                    const volume6h = hasMarketData ? (token.market.volume_6h || 0) : 0;
                    const marketCap = hasMarketData ? (token.market.market_cap || 0) : 0;
                    const buys = hasMarketData ? (token.market.txns_24h_buys || 0) : 0;
                    const sells = hasMarketData ? (token.market.txns_24h_sells || 0) : 0;
                    const pairAge = hasMarketData ? token.market.pair_created_at : 'N/A';

                    // Security data
                    const buyTax = hasSecurity ? (token.security.buy_tax || 0) : 0;
                    const sellTax = hasSecurity ? (token.security.sell_tax || 0) : 0;
                    const holders = hasSecurity ? (token.security.holder_count || 'N/A') : 'N/A';
                    const isHoneypot = hasSecurity ? token.security.is_honeypot : false;
                    const isMintable = hasSecurity ? token.security.is_mintable : false;
                    const isOpenSource = hasSecurity ? token.security.is_open_source : false;

                    // Social data
                    const socialScore = token.social_score || 0;
                    const followers = hasTwitter ? (token.twitter_data.followers || 0) : 0;
                    const tweets = hasTwitter ? (token.twitter_data.tweets || 0) : 0;

                    // Pump & Dump data
                    const pumpScore = token.pump_dump_score || 0;
                    const pumpRisk = token.pump_dump_risk || 'UNKNOWN';

                    // Risk score color
                    const riskColor = token.risk_score < 30 ? '#22c55e' :
                                     token.risk_score < 70 ? '#f59e0b' : '#ef4444';
                    const pumpColor = pumpRisk === 'FAIBLE' ? '#22c55e' :
                                      pumpRisk === 'MOYEN' ? '#f59e0b' : '#ef4444';

                    // Format numbers
                    const formatNumber = (num) => {
                        if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
                        if (num >= 1000) return (num / 1000).toFixed(2) + 'K';
                        return num.toFixed(2);
                    };

                    const formatPrice = (p) => {
                        if (p >= 1) return '$' + p.toFixed(4);
                        if (p >= 0.0001) return '$' + p.toFixed(6);
                        return '$' + p.toExponential(2);
                    };

                    const colorChange = (val) => val >= 0 ? '#22c55e' : '#ef4444';
                    const formatChange = (val) => (val >= 0 ? '+' : '') + val.toFixed(2) + '%';

                    return `
                        <div onclick="openTokenDetails(${index})" style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem; backdrop-filter: blur(20px); transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); position: relative; cursor: pointer;" onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.15)'; this.style.borderColor='var(--accent-primary)';" onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0, 0, 0, 0.1)'; this.style.borderColor='var(--border-subtle)';">

                            <!-- Compact Header -->
                            <div style="display: flex; gap: 0.75rem; align-items: start; margin-bottom: 0.75rem;">
                                <!-- Icon + Favorite -->
                                <div style="position: relative;">
                                    ${token.icon ? `
                                        <img src="${token.icon}" alt="${token.description || 'Token'}" style="width: 48px; height: 48px; border-radius: 0.5rem; background: var(--bg-glass); padding: 0.25rem;" onerror="this.style.display='none'">
                                    ` : `
                                        <div style="width: 48px; height: 48px; border-radius: 0.5rem; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">ü™ô</div>
                                    `}
                                    <button onclick="event.stopPropagation(); toggleFavorite('${token.address}', '${token.chain}', ${index});" id="fav-btn-${token.address}" style="position: absolute; top: -6px; right: -6px; background: rgba(0, 0, 0, 0.7); border: 1px solid var(--border-subtle); border-radius: 50%; width: 24px; height: 24px; cursor: pointer; transition: all 0.2s; z-index: 10; display: flex; align-items: center; justify-content: center; padding: 0;" onmouseenter="this.style.transform='scale(1.15)'; this.style.background='rgba(255, 215, 0, 0.3)'; this.style.borderColor='#ffd700';" onmouseleave="this.style.transform='scale(1)'; this.style.background='rgba(0, 0, 0, 0.7)'; this.style.borderColor='var(--border-subtle)';">
                                        <span style="font-size: 0.75rem;">‚≠ê</span>
                                    </button>
                                </div>

                                <!-- Title + Badges -->
                                <div style="flex: 1; min-width: 0;">
                                    <h4 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.25rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        ${token.description || 'Token ' + (index + 1)}
                                    </h4>
                                    <div style="font-family: monospace; font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.4rem;">
                                        ${token.address.substring(0, 8)}...${token.address.substring(token.address.length - 6)}
                                    </div>
                                    <div style="display: flex; gap: 0.35rem; flex-wrap: wrap;">
                                        <span style="background: var(--bg-glass); padding: 0.15rem 0.5rem; border-radius: 0.75rem; font-size: 0.7rem; text-transform: uppercase; font-weight: 600;">
                                            ${token.chain}
                                        </span>
                                        ${token.is_safe ? '<span style="background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 0.15rem 0.5rem; border-radius: 0.75rem; font-size: 0.7rem; font-weight: 600;">‚úÖ SAFE</span>' : '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 0.15rem 0.5rem; border-radius: 0.75rem; font-size: 0.7rem; font-weight: 600;">‚ö†Ô∏è RISKY</span>'}
                                        ${token.is_pump_dump_suspect ? '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 0.15rem 0.5rem; border-radius: 0.75rem; font-size: 0.7rem; font-weight: 600;">üö® P&D</span>' : ''}
                                        ${token.creator_security?.is_malicious ? '<span style="background: rgba(220, 38, 38, 0.25); color: #dc2626; padding: 0.15rem 0.5rem; border-radius: 0.75rem; font-size: 0.7rem; font-weight: 700; border: 1px solid #dc2626;">üíÄ SCAMMER</span>' : ''}
                                        ${token.rugpull_detection?.is_rugpull_risk ? `<span style="background: rgba(245, 158, 11, 0.2); color: #f59e0b; padding: 0.15rem 0.5rem; border-radius: 0.75rem; font-size: 0.7rem; font-weight: 600;">üé£ RUG-PULL</span>` : ''}
                                    </div>
                                </div>

                                <!-- Risk Score + Price -->
                                <div style="text-align: right;">
                                    <div style="background: ${riskColor}; color: white; padding: 0.4rem 0.75rem; border-radius: 0.5rem; font-weight: 700; font-size: 0.875rem; margin-bottom: 0.35rem; box-shadow: 0 2px 8px rgba(0,0,0,0.2); white-space: nowrap;">
                                        ${token.risk_score}
                                    </div>
                                    ${hasMarketData ? `
                                        <div id="price-${token.address}" style="font-size: 1rem; font-weight: 700; margin-bottom: 0.15rem;">
                                            ${formatPrice(price)}
                                        </div>
                                        <div id="change-${token.address}" style="color: ${colorChange(change24h)}; font-weight: 600; font-size: 0.75rem; margin-bottom: 0.5rem;">
                                            ${formatChange(change24h)}
                                        </div>
                                        <button onclick="event.stopPropagation(); refreshTokenPrice('${token.address}', '${token.chain}', ${index});" id="refresh-btn-${token.address}" style="background: var(--gradient-primary); border: none; border-radius: 0.5rem; padding: 0.35rem 0.6rem; font-size: 0.7rem; font-weight: 600; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); display: flex; align-items: center; gap: 0.25rem; margin: 0 auto;" onmouseenter="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.5)';" onmouseleave="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(102, 126, 234, 0.3)';">
                                            <span id="refresh-icon-${token.address}">üîÑ</span>
                                            <span>Prix</span>
                                        </button>
                                    ` : '<div style="color: var(--text-tertiary); font-size: 0.7rem;">No data</div>'}
                                </div>
                            </div>

                            <!-- Quick Stats (2x4 Grid) -->
                            ${hasMarketData ? `
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-bottom: 0.75rem;">
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">üíß Liq</div>
                                        <div style="font-weight: 700; font-size: 0.75rem;">$${formatNumber(liquidity)}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">üìä Vol</div>
                                        <div style="font-weight: 700; font-size: 0.75rem;">$${formatNumber(volume24h)}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">üíé MCap</div>
                                        <div style="font-weight: 700; font-size: 0.75rem;">$${formatNumber(marketCap)}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">‚è∞ Age</div>
                                        <div style="font-weight: 700; font-size: 0.7rem;">${pairAge !== 'N/A' ? Math.floor((Date.now() - pairAge * 1000) / (1000 * 60 * 60)) + 'h' : 'N/A'}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">1H</div>
                                        <div style="font-weight: 700; font-size: 0.75rem; color: ${colorChange(change1h)};">${formatChange(change1h)}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">6H</div>
                                        <div style="font-weight: 700; font-size: 0.75rem; color: ${colorChange(change6h)};">${formatChange(change6h)}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">üü¢ Buys</div>
                                        <div style="font-weight: 700; font-size: 0.75rem; color: #22c55e;">${buys}</div>
                                    </div>
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.5rem; text-align: center;">
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary); margin-bottom: 0.15rem;">üî¥ Sells</div>
                                        <div style="font-weight: 700; font-size: 0.75rem; color: #ef4444;">${sells}</div>
                                    </div>
                                </div>
                            ` : `
                                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 0.75rem;">
                                    <div style="color: #ef4444; font-weight: 600; font-size: 0.75rem; text-align: center;">
                                        ‚ö†Ô∏è Market data unavailable
                                    </div>
                                </div>
                            `}

                            <!-- Compact Security + P&D Row -->
                            <div style="display: grid; grid-template-columns: ${hasSecurity && hasTwitter ? 'repeat(3, 1fr)' : hasSecurity || hasTwitter ? 'repeat(2, 1fr)' : '1fr'}; gap: 0.5rem; margin-bottom: 0.75rem;">
                                ${hasSecurity ? `
                                    <div style="background: var(--bg-glass); border-radius: 0.5rem; padding: 0.75rem;">
                                        <div style="font-size: 0.7rem; color: var(--text-tertiary); margin-bottom: 0.4rem; font-weight: 600;">üîí SECURITY</div>
                                        <div style="display: flex; flex-direction: column; gap: 0.3rem; font-size: 0.7rem;">
                                            <div style="display: flex; justify-content: space-between;">
                                                <span>Tax:</span>
                                                <span style="font-weight: 600; color: ${(buyTax + sellTax) > 15 ? '#ef4444' : '#22c55e'};">${buyTax.toFixed(1)}%/${sellTax.toFixed(1)}%</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span>HP:</span>
                                                <span style="font-weight: 600; color: ${isHoneypot ? '#ef4444' : '#22c55e'};">${isHoneypot ? '‚ùå' : '‚úÖ'}</span>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                                ${hasTwitter ? `
                                    <div style="background: linear-gradient(135deg, rgba(29, 161, 242, 0.1) 0%, rgba(29, 161, 242, 0.05) 100%); border: 1px solid rgba(29, 161, 242, 0.2); border-radius: 0.5rem; padding: 0.75rem;">
                                        <div style="font-size: 0.7rem; color: #1da1f2; margin-bottom: 0.3rem; font-weight: 600;">üê¶ SOCIAL</div>
                                        <div style="font-size: 1.25rem; font-weight: 700; color: #1da1f2;">${socialScore}/100</div>
                                        <div style="font-size: 0.65rem; color: var(--text-tertiary);">${formatNumber(followers)} followers</div>
                                    </div>
                                ` : ''}
                                <div style="background: linear-gradient(135deg, ${pumpColor}15 0%, ${pumpColor}08 100%); border: 1px solid ${pumpColor}66; border-radius: 0.5rem; padding: 0.75rem;">
                                    <div style="font-size: 0.7rem; color: ${pumpColor}; margin-bottom: 0.3rem; font-weight: 600;">üö® P&D RISK</div>
                                    <div style="font-size: 1.25rem; font-weight: 700; color: ${pumpColor};">${pumpScore}/100</div>
                                    <div style="font-size: 0.65rem; font-weight: 600; color: ${pumpColor};">${pumpRisk}</div>
                                </div>
                            </div>

                            <!-- Compact Warnings -->
                            ${(token.warnings && token.warnings.length > 0) || (token.pump_dump_warnings && token.pump_dump_warnings.length > 0) ? `
                                <div style="background: rgba(239, 68, 68, 0.08); border-left: 3px solid #ef4444; border-radius: 0.5rem; padding: 0.6rem 0.75rem; margin-bottom: 0.75rem;">
                                    <div style="font-weight: 600; font-size: 0.75rem; color: #ef4444; margin-bottom: 0.4rem;">‚ö†Ô∏è WARNINGS</div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary); line-height: 1.4;">
                                        ${(() => {
                                            const allWarnings = [...(token.warnings || []), ...(token.pump_dump_warnings || [])];
                                            const displayWarnings = allWarnings.slice(0, 3).map(w => `‚Ä¢ ${w}`).join(' ');
                                            const moreCount = allWarnings.length > 3 ? ` <span style="color: #f59e0b;">+${allWarnings.length - 3} more</span>` : '';
                                            return displayWarnings + moreCount;
                                        })()}
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Compact Action Buttons -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem;">
                                <button onclick="event.stopPropagation(); analyzeTokenWithAI(${index}, this);" style="padding: 0.6rem 0.75rem; background: var(--gradient-primary); color: white; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.4rem; transition: all 0.2s; box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3); font-size: 0.8rem;" onmouseenter="this.style.transform='scale(1.03)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.5)';" onmouseleave="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 4px rgba(102, 126, 234, 0.3)';">
                                    <span>ü§ñ</span>
                                    <span>AI</span>
                                </button>
                                ${token.url ? `
                                    <a href="${token.url}" target="_blank" style="padding: 0.6rem 0.75rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); color: var(--text-primary); text-decoration: none; border-radius: 0.5rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.4rem; transition: all 0.2s; font-size: 0.8rem;" onmouseenter="this.style.transform='scale(1.03)'; this.style.borderColor='var(--accent-primary)';" onmouseleave="this.style.transform='scale(1)'; this.style.borderColor='var(--border-subtle)';">
                                        <span>üìä</span>
                                        <span>Dex</span>
                                    </a>
                                ` : ''}
                                ${token.twitter ? `
                                    <a href="${token.twitter}" target="_blank" style="padding: 0.6rem 0.75rem; background: rgba(29, 161, 242, 0.1); border: 1px solid rgba(29, 161, 242, 0.3); color: #1da1f2; text-decoration: none; border-radius: 0.5rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.4rem; transition: all 0.2s; font-size: 0.8rem;" onmouseenter="this.style.transform='scale(1.03)'; this.style.background='rgba(29, 161, 242, 0.2)';" onmouseleave="this.style.transform='scale(1)'; this.style.background='rgba(29, 161, 242, 0.1)';">
                                        <span>üê¶</span>
                                        <span>X</span>
                                    </a>
                                ` : ''}
                                ${token.website ? `
                                    <a href="${token.website}" target="_blank" style="padding: 0.6rem 0.75rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6; text-decoration: none; border-radius: 0.5rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.4rem; transition: all 0.2s; font-size: 0.8rem;" onmouseenter="this.style.transform='scale(1.03)'; this.style.background='rgba(139, 92, 246, 0.2)';" onmouseleave="this.style.transform='scale(1)'; this.style.background='rgba(139, 92, 246, 0.1)';">
                                        <span>üåê</span>
                                        <span>Web</span>
                                    </a>
                                ` : ''}
                                ${token.telegram ? `
                                    <a href="${token.telegram}" target="_blank" style="padding: 0.6rem 0.75rem; background: rgba(34, 197, 233, 0.1); border: 1px solid rgba(34, 197, 233, 0.3); color: #22c5e9; text-decoration: none; border-radius: 0.5rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.4rem; transition: all 0.2s; font-size: 0.8rem;" onmouseenter="this.style.transform='scale(1.03)'; this.style.background='rgba(34, 197, 233, 0.2)';" onmouseleave="this.style.transform='scale(1)'; this.style.background='rgba(34, 197, 233, 0.1)';">
                                        <span>‚úàÔ∏è</span>
                                        <span>TG</span>
                                    </a>
                                ` : ''}
                                ${token.discord ? `
                                    <a href="${token.discord}" target="_blank" style="padding: 0.6rem 0.75rem; background: rgba(88, 101, 242, 0.1); border: 1px solid rgba(88, 101, 242, 0.3); color: #5865f2; text-decoration: none; border-radius: 0.5rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.4rem; transition: all 0.2s; font-size: 0.8rem;" onmouseenter="this.style.transform='scale(1.03)'; this.style.background='rgba(88, 101, 242, 0.2)';" onmouseleave="this.style.transform='scale(1)'; this.style.background='rgba(88, 101, 242, 0.1)';">
                                        <span>üí¨</span>
                                        <span>DC</span>
                                    </a>
                                ` : ''}
                            </div>

                            <!-- AI Analysis Result -->
                            <div id="ai-result-${token.address}" style="display: none; margin-top: 1.5rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1.25rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                    <span style="font-size: 1.5rem;">ü§ñ</span>
                                    <h5 style="font-weight: 700; font-size: 1.125rem;">Analyse Claude IA</h5>
                                </div>
                                <div id="ai-content-${token.address}" style="color: var(--text-secondary); line-height: 1.8; white-space: pre-wrap;"></div>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 1px solid var(--accent-primary); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; text-align: center;">
                        <h3 style="font-size: 1.75rem; font-weight: 900; margin-bottom: 0.5rem;">‚úÖ Scan Termin√© !</h3>
                        <p style="color: var(--text-secondary); font-size: 1.125rem;">
                            ${data.results.length} token(s) analys√©(s) ‚Ä¢
                            <span style="color: #22c55e; font-weight: 600;">${data.safe_count || 0} s√ªrs</span> ‚Ä¢
                            <span style="color: #ef4444; font-weight: 600;">${data.dangerous_count || 0} risqu√©s</span> ‚Ä¢
                            <span style="color: #f59e0b; font-weight: 600;">${data.pump_dump_suspects_count || 0} P&D suspects</span>
                        </p>
                        <p style="color: var(--accent-success); font-size: 0.875rem; margin-top: 0.5rem;">
                            üíæ Tokens sauvegard√©s en base de donn√©es
                        </p>
                    </div>
                    ${tokensHTML}
                `;

                // Refresh stats
                loadUserInfo();

                // Update favorite buttons state
                updateFavoriteButtons();
            } else {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ü§∑</div>
                        <p>Aucun token trouv√©</p>
                    </div>
                `;
            }
        }

        // AI Token Analysis
        async function analyzeTokenWithAI(tokenIndex, buttonElement) {
            // Get token data from global array
            const tokenData = window.currentTokens[tokenIndex];
            if (!tokenData) {
                console.error('Token not found at index:', tokenIndex);
                return;
            }

            const address = tokenData.address;
            const chain = tokenData.chain;
            const resultDiv = document.getElementById(`ai-result-${address}`);
            const contentDiv = document.getElementById(`ai-content-${address}`);

            // Show loading state
            buttonElement.disabled = true;
            buttonElement.innerHTML = '<span>‚è≥</span><span>Analyse en cours...</span>';
            resultDiv.style.display = 'block';
            contentDiv.innerHTML = '<div style="text-align: center; padding: 1rem;"><div style="border: 3px solid var(--bg-glass); border-top: 3px solid var(--accent-primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto;"></div><p style="margin-top: 0.5rem;">Claude analyse le token...</p></div>';

            try {
                const response = await fetch('/api/analyze-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        address: address,
                        chain: chain,
                        token_data: tokenData
                    })
                });

                const data = await response.json();

                if (data.success) {
                    contentDiv.innerHTML = data.analysis || 'Analyse termin√©e.';
                } else {
                    contentDiv.innerHTML = `<div style="color: #ef4444;">‚ùå Erreur: ${data.error || 'Impossible d\'analyser le token'}</div>`;
                }
            } catch (error) {
                contentDiv.innerHTML = `<div style="color: #ef4444;">‚ùå Erreur de connexion: ${error.message}</div>`;
            } finally {
                buttonElement.disabled = false;
                buttonElement.innerHTML = '<span>ü§ñ</span><span>Scan par IA</span>';
            }
        }

        // ==================== AUTO-SCAN SYSTEM ====================
        let autoScanInterval = null;
        let countdownInterval = null;
        let secondsRemaining = 300; // 5 minutes = 300 seconds

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateCountdown() {
            const timerElement = document.getElementById('countdown-timer');
            if (timerElement) {
                timerElement.textContent = formatTime(secondsRemaining);

                // Color change based on time remaining
                if (secondsRemaining <= 30) {
                    timerElement.style.color = '#ef4444'; // Red when <30s
                } else if (secondsRemaining <= 60) {
                    timerElement.style.color = '#f59e0b'; // Orange when <1min
                } else {
                    timerElement.style.color = 'var(--accent-primary)'; // Normal
                }
            }

            secondsRemaining--;

            if (secondsRemaining < 0) {
                // Time's up! Trigger auto-scan
                secondsRemaining = 300; // Reset to 5 minutes
                triggerAutoScan();
            }
        }

        async function triggerAutoScan() {
            console.log('ü§ñ Auto-scan triggered!');

            // Check if already scanning
            const btn = document.getElementById('start-scan-btn');
            if (btn.disabled) {
                console.log('‚è∏Ô∏è Scan already in progress, skipping auto-scan');
                return;
            }

            // Trigger scan with notification
            const countdownDiv = document.getElementById('auto-scan-countdown');
            const originalHTML = countdownDiv.innerHTML;

            // Show auto-scan message
            countdownDiv.innerHTML = `
                <span>ü§ñ</span>
                <span>Scan automatique en cours...</span>
            `;
            countdownDiv.style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2))';
            countdownDiv.style.borderColor = 'var(--accent-primary)';

            // Start scan
            await startScan();

            // Wait a bit before resetting display
            setTimeout(() => {
                countdownDiv.innerHTML = originalHTML;
                countdownDiv.style.background = 'var(--bg-glass)';
                countdownDiv.style.borderColor = '';
            }, 3000);
        }

        function startAutoScanSystem() {
            console.log('üöÄ Auto-scan system initialized (5-minute intervals)');

            // Start countdown
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(updateCountdown, 1000);

            // Initial countdown display
            updateCountdown();
        }

        function stopAutoScanSystem() {
            if (autoScanInterval) {
                clearInterval(autoScanInterval);
                autoScanInterval = null;
            }
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            console.log('‚èπÔ∏è Auto-scan system stopped');
        }

        // ==================== CRYPTO NEWS ====================
        async function loadCryptoNews(forceRefresh = false) {
            const newsList = document.getElementById('news-list');
            const cacheInfo = document.getElementById('news-cache-info');

            try {
                const url = `/api/news/crypto?limit=10&force_refresh=${forceRefresh}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.success && data.articles) {
                    // Display cache info
                    if (data.cached) {
                        const expiresMin = Math.floor(data.cache_expires_in / 60);
                        cacheInfo.textContent = `‚úÖ Cache actif - Expire dans ${expiresMin} minutes`;
                        cacheInfo.style.color = 'var(--accent-success)';
                    } else {
                        cacheInfo.textContent = `üÜï Actualit√©s fra√Æches - Cache valide 30 minutes`;
                        cacheInfo.style.color = 'var(--accent-primary)';
                    }

                    // Display articles
                    newsList.innerHTML = data.articles.map((article, index) => `
                        <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem; transition: all 0.2s; cursor: pointer;" onmouseenter="this.style.borderColor='var(--accent-primary)'" onmouseleave="this.style.borderColor='var(--border-subtle)'" onclick="window.open('${article.url}', '_blank')">
                            <div style="display: flex; gap: 1rem;">
                                ${article.image_url ? `
                                    <img src="${article.image_url}" style="width: 80px; height: 80px; border-radius: 0.5rem; object-fit: cover;" onerror="this.style.display='none'">
                                ` : ''}
                                <div style="flex: 1;">
                                    <h4 style="font-size: 0.95rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text-primary);">${article.title}</h4>
                                    <div style="display: flex; gap: 1rem; font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.5rem;">
                                        <span>üìÖ ${article.published_date}</span>
                                        <span>üì∞ ${article.source}</span>
                                        ${article.sentiment !== 'NEUTRAL' ? `<span style="color: ${article.sentiment === 'POSITIVE' ? '#22c55e' : '#ef4444'};">‚óè ${article.sentiment}</span>` : ''}
                                    </div>
                                    ${article.categories.length > 0 ? `
                                        <div style="display: flex; gap: 0.35rem; flex-wrap: wrap;">
                                            ${article.categories.slice(0, 3).map(cat => `<span style="background: var(--bg-glass); padding: 0.15rem 0.5rem; border-radius: 0.5rem; font-size: 0.65rem; color: var(--text-secondary);">${cat}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');

                    console.log(`‚úÖ Loaded ${data.articles.length} news articles`);
                } else {
                    newsList.innerHTML = `<div class="empty-state" style="text-align: center; padding: 2rem; color: var(--text-secondary);"><div style="font-size: 3rem; margin-bottom: 0.5rem;">üì≠</div><p>Aucune actualit√© disponible</p></div>`;
                }
            } catch (error) {
                console.error('Error loading news:', error);
                newsList.innerHTML = `<div class="empty-state" style="text-align: center; padding: 2rem; color: var(--accent-danger);"><div style="font-size: 3rem; margin-bottom: 0.5rem;">‚ùå</div><p>Erreur de chargement des actualit√©s</p></div>`;
            }
        }

        async function refreshNews() {
            const refreshIcon = document.getElementById('news-refresh-icon');
            refreshIcon.style.animation = 'spin 1s linear infinite';
            await loadCryptoNews(true);
            setTimeout(() => {
                refreshIcon.style.animation = 'none';
            }, 1000);
        }

        // ==================== TOKEN SEARCH ====================
        async function searchToken() {
            const input = document.getElementById('token-search-input');
            const resultsDiv = document.getElementById('token-search-results');
            const query = input.value.trim();

            if (!query) {
                resultsDiv.innerHTML = '';
                return;
            }

            // Show loading
            resultsDiv.innerHTML = `<div class="loading" style="text-align: center; padding: 1rem;"><div class="spinner" style="border: 3px solid var(--bg-glass); border-top: 3px solid var(--accent-primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto;"></div></div>`;

            try {
                const response = await fetch(`/api/token/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.success && data.tokens && data.tokens.length > 0) {
                    resultsDiv.innerHTML = data.tokens.map(token => `
                        <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 0.75rem; padding: 1.25rem; margin-top: 1rem;">
                            <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;">
                                ${token.logo ? `<img src="${token.logo}" style="width: 56px; height: 56px; border-radius: 0.75rem;">` : '<div style="width: 56px; height: 56px; border-radius: 0.75rem; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 1.75rem;">ü™ô</div>'}
                                <div style="flex: 1;">
                                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.25rem;">${token.name} <span style="color: var(--text-secondary); font-weight: 600;">(${token.symbol})</span></h3>
                                    <div style="font-size: 0.875rem; color: var(--text-tertiary); margin-bottom: 0.5rem;">
                                        ${token.category ? `<span style="background: var(--bg-glass); padding: 0.15rem 0.5rem; border-radius: 0.5rem; font-size: 0.75rem; text-transform: uppercase; margin-right: 0.5rem;">${token.category}</span>` : ''}
                                        ${token.date_launched ? `Lanc√©: ${new Date(token.date_launched).toLocaleDateString('fr-FR')}` : ''}
                                    </div>
                                    ${token.tags && token.tags.length > 0 ? `
                                        <div style="display: flex; gap: 0.35rem; flex-wrap: wrap; margin-bottom: 0.75rem;">
                                            ${token.tags.slice(0, 5).map(tag => `<span style="background: rgba(102, 126, 234, 0.1); color: var(--accent-primary); padding: 0.15rem 0.5rem; border-radius: 0.5rem; font-size: 0.7rem;">${tag}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            ${token.description ? `<p style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">${token.description.substring(0, 300)}${token.description.length > 300 ? '...' : ''}</p>` : ''}

                            ${token.urls ? `
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.5rem;">
                                    ${token.urls.website && token.urls.website.length > 0 ? `<a href="${token.urls.website[0]}" target="_blank" style="padding: 0.5rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6; text-decoration: none; border-radius: 0.5rem; text-align: center; font-size: 0.8rem; font-weight: 600;">üåê Website</a>` : ''}
                                    ${token.urls.twitter && token.urls.twitter.length > 0 ? `<a href="${token.urls.twitter[0]}" target="_blank" style="padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); color: #3b82f6; text-decoration: none; border-radius: 0.5rem; text-align: center; font-size: 0.8rem; font-weight: 600;">ùïè Twitter</a>` : ''}
                                    ${token.urls.reddit && token.urls.reddit.length > 0 ? `<a href="${token.urls.reddit[0]}" target="_blank" style="padding: 0.5rem; background: rgba(249, 115, 22, 0.1); border: 1px solid rgba(249, 115, 22, 0.3); color: #f97316; text-decoration: none; border-radius: 0.5rem; text-align: center; font-size: 0.8rem; font-weight: 600;">üî∂ Reddit</a>` : ''}
                                    ${token.urls.explorer && token.urls.explorer.length > 0 ? `<a href="${token.urls.explorer[0]}" target="_blank" style="padding: 0.5rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; text-decoration: none; border-radius: 0.5rem; text-align: center; font-size: 0.8rem; font-weight: 600;">üîç Explorer</a>` : ''}
                                    ${token.urls.source_code && token.urls.source_code.length > 0 ? `<a href="${token.urls.source_code[0]}" target="_blank" style="padding: 0.5rem; background: var(--bg-glass); border: 1px solid var(--border-subtle); color: var(--text-secondary); text-decoration: none; border-radius: 0.5rem; text-align: center; font-size: 0.8rem; font-weight: 600;">üíª Code</a>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `).join('');

                    console.log(`‚úÖ Found ${data.tokens.length} token(s)`);
                } else {
                    resultsDiv.innerHTML = `<div class="empty-state" style="text-align: center; padding: 2rem; color: var(--text-secondary);"><div style="font-size: 3rem; margin-bottom: 0.5rem;">üîç</div><p>Aucun token trouv√© pour "${query}"</p><p style="font-size: 0.8rem; margin-top: 0.5rem;">Essayez avec un symbole (BTC, ETH) ou nom complet (bitcoin, ethereum)</p></div>`;
                }
            } catch (error) {
                console.error('Error searching token:', error);
                resultsDiv.innerHTML = `<div class="empty-state" style="text-align: center; padding: 2rem; color: var(--accent-danger);"><div style="font-size: 3rem; margin-bottom: 0.5rem;">‚ùå</div><p>Erreur de recherche</p></div>`;
            }
        }

        // Initialize
        loadUserInfo();
        loadTokensFromDatabase();  // Load tokens from database on page load
        loadCryptoNews();  // Load crypto news on page load
        startAutoScanSystem();

        // Auto-refresh tokens from database every 5 minutes (sync with auto-scan)
        setInterval(() => {
            console.log('üîÑ Auto-refreshing tokens from database...');
            loadTokensFromDatabase();
        }, 5 * 60 * 1000);  // 5 minutes

        // Stop auto-scan when user leaves page
        window.addEventListener('beforeunload', () => {
            stopAutoScanSystem();
        });
    </script>

    <!-- Auth Modal (Login/Register) -->
    {% include 'components_auth_modal.html' %}
</body>
</html>
